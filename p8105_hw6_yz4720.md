p8105_hw6_yz4720
================
Jasmine Zhang
2023-12-02

## Problem 1

### Data Import and Tidy

``` r
homicide_df = read_csv("./data/homicide-data.csv", na = c("", "NA", "Unknown")) |> 
  mutate(city_state = str_c(city, state, sep = ", "),
         victim_age = as.numeric(victim_age),
         resolution = case_when(disposition == "Closed without arrest" ~ 0,
                                disposition == "Open/No arrest" ~ 0,
                                disposition == "Closed by arrest" ~ 1)) |> 
  filter(!(city_state %in% c("Tulsa, AL", "Dallas, TX", "Phoenix, AZ", "Kansas City, MO")),
         victim_race %in% c("Black", "White")) |> 
  select(city_state, resolution, victim_age, victim_sex, victim_race)
```

### Baltimore, MD

``` r
baltimore_glm = filter(homicide_df, city_state == "Baltimore, MD") |> 
  glm(resolution ~ victim_age + victim_sex + victim_race, family = binomial(), data = _)
baltimore_glm |> 
  broom::tidy()|> 
  mutate(
    OR = exp(estimate), 
    OR_CI_upper = exp(estimate + 1.96 * std.error),
    OR_CI_lower = exp(estimate - 1.96 * std.error)) |> 
  filter(term == "victim_sexMale") |> 
  select(OR, OR_CI_lower, OR_CI_upper)
```

    ## # A tibble: 1 × 3
    ##      OR OR_CI_lower OR_CI_upper
    ##   <dbl>       <dbl>       <dbl>
    ## 1 0.426       0.325       0.558

### glm all cities

``` r
model_results = 
  homicide_df |> 
  nest(data = -city_state) |> 
  mutate(models = map(data, \(data) glm(resolution ~ victim_age + victim_sex + victim_race, 
                                        family = binomial(), data = data)),
         results = map(models, broom::tidy))  |> 
  select(-models, -data) |> 
  unnest(cols = results)|> 
  mutate(
    OR = exp(estimate), 
    OR_CI_upper = exp(estimate + 1.96 * std.error),
    OR_CI_lower = exp(estimate - 1.96 * std.error))|> 
  filter(term == "victim_sexMale") |> 
  select(city_state, OR, OR_CI_lower, OR_CI_upper) 
model_results |>
  slice(1:5) |> 
  knitr::kable(digits = 3)           
```

| city_state      |    OR | OR_CI_lower | OR_CI_upper |
|:----------------|------:|------------:|------------:|
| Albuquerque, NM | 1.767 |       0.831 |       3.761 |
| Atlanta, GA     | 1.000 |       0.684 |       1.463 |
| Baltimore, MD   | 0.426 |       0.325 |       0.558 |
| Baton Rouge, LA | 0.381 |       0.209 |       0.695 |
| Birmingham, AL  | 0.870 |       0.574 |       1.318 |

### plot: OR and CI for all cities

``` r
model_results |> 
  mutate(city_state = fct_reorder(city_state, OR)) |> 
  ggplot(aes(x = city_state, y = OR)) + 
  geom_point() + 
  geom_errorbar(aes(ymin = OR_CI_lower, ymax = OR_CI_upper)) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

<img src="p8105_hw6_yz4720_files/figure-gfm/unnamed-chunk-4-1.png" width="90%" />

The plot shows OR and CI for each city ordered by the magnitude of OR.
Most of the cities have OR less than 1, which means that crimes with
male victims have smaller odds of resolution compared to crimes with
female victims after adjusting for victim age and race. For cities with
CI that doesn’t include 1, it suggests a significant difference in
resolution rates by sex after adjustment for victim age and race.

## Problem 2

``` r
weather_df = 
  rnoaa::meteo_pull_monitors(
    c("USW00094728"),
    var = c("PRCP", "TMIN", "TMAX"), 
    date_min = "2022-01-01",
    date_max = "2022-12-31") |>
  mutate(
    name = recode(id, USW00094728 = "CentralPark_NY"),
    tmin = tmin / 10,
    tmax = tmax / 10) |>
  select(name, id, everything())
```
